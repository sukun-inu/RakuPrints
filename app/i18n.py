from __future__ import annotations

import locale
import sys
from typing import Dict


LANGUAGES = {
    "system": {
        "ja": "OSに合わせる",
        "en": "Follow system",
        "ko": "시스템 설정 사용",
        "zh": "跟随系统",
    },
    "ja": {"ja": "日本語", "en": "Japanese", "ko": "일본어", "zh": "日语"},
    "en": {"ja": "英語", "en": "English", "ko": "영어", "zh": "英语"},
    "ko": {"ja": "韓国語", "en": "Korean", "ko": "한국어", "zh": "韩语"},
    "zh": {"ja": "中国語", "en": "Chinese", "ko": "중국어", "zh": "中文(简体)"},
}


TRANSLATIONS: Dict[str, Dict[str, str]] = {
    "ja": {
        "app_title": "らーく印刷",
        "menu_file": "ファイル",
        "menu_help": "ヘルプ",
        "action_add_files": "ファイル追加",
        "action_add_folder": "フォルダー追加",
        "action_apply_rules": "ルールで自動設定（手動は保護）",
        "action_apply_rules_force": "ルールで全部上書き",
        "action_exit": "終了",
        "action_about": "このアプリについて",
        "action_log_summary": "ログの要約",
        "action_check_updates": "更新を確認",
        "button_start_printing": "印刷開始",
        "button_retry_failed": "失敗だけ再印刷",
        "status_ready": "準備完了",
        "status_jobs_fmt": "ジョブ数: {total} | 完了: {completed} | 失敗: {failed}",
        "title_print": "印刷",
        "title_retry": "再印刷",
        "title_printer": "プリンター",
        "title_rules": "ルール",
        "title_delete": "削除",
        "title_excel": "Excel",
        "title_update": "更新",
        "msg_no_files": "印刷するファイルがありません。",
        "msg_no_checked": "印刷するチェックが入ったファイルがありません。",
        "msg_no_selected_rows": "選択された行がありません。",
        "msg_no_failed": "失敗した印刷はありません。",
        "title_print_failed": "印刷に失敗しました",
        "msg_print_failed": "印刷に失敗しました。",
        "msg_printing_in_progress": "印刷中です。完了を待つか、キャンセルしてください。",
        "msg_excel_orientation_checking": "Excel の向きを確認中です...",
        "title_checking": "確認中",
        "msg_printer_not_selected": "プリンターが選ばれていません。",
        "msg_rule_exists": "すでに追加されています。",
        "msg_delete_confirm_fmt": "選択した {count} 件を削除しますか？",
        "msg_excel_sheet_required": "1つ以上選んでください。",
        "msg_update_available_fmt": "新しいバージョン {version} が見つかりました。\n更新しますか？",
        "msg_update_none": "新しい更新は見つかりませんでした。",
        "msg_update_error_fmt": "更新の確認に失敗しました。\n{error}",
        "msg_update_downloading": "更新をダウンロードしています...",
        "msg_update_apply": "更新を適用して再起動しますか？",
        "btn_update_now": "今すぐ更新",
        "btn_update_later": "あとで通知（14日）",
        "btn_update_skip": "今回はしない",
        "btn_close": "閉じる",
        "btn_open_log": "詳細ログを開く",
        "settings_printer_group": "プリンター設定",
        "settings_rules_group": "ファイルの種類ごとのプリンター",
        "settings_display_group": "表示",
        "settings_update_group": "更新",
        "settings_use_default": "既定のプリンターを使う",
        "settings_select_printer": "プリンターを指定する",
        "settings_select_printer_button": "プリンターを選ぶ",
        "settings_printer_settings_button": "プリンターの詳細設定",
        "settings_copies": "部数:",
        "settings_duplex": "両面印刷:",
        "duplex_off": "しない",
        "duplex_long": "長辺とじ",
        "duplex_short": "短辺とじ",
        "settings_paper_size": "用紙サイズ:",
        "settings_excel_orientation": "Excelの向き:",
        "settings_excel_auto": "自動で調整",
        "settings_excel_ask": "確認してから",
        "settings_excel_none": "変更しない",
        "settings_rules_type": "種類（PDFなど）",
        "settings_rules_printer": "プリンター",
        "settings_add": "追加",
        "settings_remove": "削除",
        "rules_add_title": "拡張子を追加",
        "rules_add_prompt": "拡張子を入力してください（例: .pdf）",
        "settings_theme": "テーマ:",
        "settings_theme_system": "OSに合わせる",
        "settings_theme_light": "ライト",
        "settings_theme_dark": "ダーク",
        "settings_language": "言語:",
        "settings_update_check": "起動時に更新を確認",
        "settings_update_auto": "自動アップデートを有効にする",
        "rules_auto_tooltip_fmt": "自動（既定）: {printer}",
        "printer_button_default_fmt": "プリンターを選ぶ（既定: {label}）",
        "printer_button_current_fmt": "プリンターを選ぶ（現在: {label}）",
        "paper_size_default": "プリンターの既定",
        "paper_size_unavailable": "このプリンターから用紙サイズを取得できません。",
        "table_print": "印刷",
        "table_file": "ファイル名",
        "table_path": "場所",
        "table_type": "種類",
        "table_label": "ラベル",
        "table_sheet": "シート",
        "table_printer": "プリンター",
        "table_status": "状態",
        "status_waiting": "待機",
        "status_printing": "印刷中",
        "status_success": "完了",
        "status_failed": "失敗",
        "status_cancelled": "キャンセル",
        "status_skipped": "スキップ",
        "label_auto": "自動",
        "label_all_sheets": "全シート",
        "label_pdf": "PDF資料",
        "label_word": "Word文書",
        "label_excel": "Excel表",
        "label_ppt": "PowerPoint資料",
        "label_unknown": "不明",
        "context_print_selected": "選択行のみ印刷",
        "context_printer_select": "プリンター個別指定",
        "context_excel_sheets": "Excelシートを選ぶ",
        "context_enable": "選択を有効にする",
        "context_disable": "選択を無効にする",
        "context_delete": "選択を削除",
        "progress_title": "印刷中",
        "progress_preparing": "準備しています...",
        "progress_printing_fmt": "印刷中: {current}",
        "progress_printing": "印刷中...",
        "progress_cancel": "キャンセル",
        "progress_cancelled": "キャンセルしました",
        "progress_done": "完了しました",
        "about_title": "このアプリについて",
        "about_text": "らーく印刷\n印刷ジョブ管理ツール",
        "about_info": "Windows + Office 環境でまとめて印刷できるように作られています。\nCopyright © 2026 Hibiki Suzuki",
        "log_title": "ログの要約",
        "log_heading": "印刷エラーの要約",
        "log_file": "ファイル名",
        "log_summary": "要約",
        "log_detail": "詳細",
        "log_no_errors": "失敗した印刷はありません。",
        "printer_select_title": "プリンターを選ぶ",
        "excel_sheet_title": "Excel シート選択",
        "excel_sheet_prompt_fmt": "{file} のシートを選んでください",
        "excel_sheet_select_all": "全選択",
        "excel_sheet_clear": "全解除",
        "excel_orientation_title": "Excelの向き確認",
        "excel_orientation_prompt": "Excel の向き推奨を確認してください。\n印刷時に自動で向きを調整しますか？",
        "excel_orientation_file": "ファイル",
        "excel_orientation_recommend": "推奨",
        "excel_orientation_reason": "理由",
        "excel_orientation_apply": "適用",
        "excel_orientation_select_all": "すべて適用",
        "excel_orientation_clear": "すべて解除",
        "update_checking": "更新を確認中...",
    },
    "en": {
        "app_title": "Raku Print",
        "menu_file": "File",
        "menu_help": "Help",
        "action_add_files": "Add Files",
        "action_add_folder": "Add Folder",
        "action_apply_rules": "Apply Rules (keep manual)",
        "action_apply_rules_force": "Apply Rules (overwrite all)",
        "action_exit": "Exit",
        "action_about": "About",
        "action_log_summary": "Log Summary",
        "action_check_updates": "Check for Updates",
        "button_start_printing": "Start Printing",
        "button_retry_failed": "Reprint Failed",
        "status_ready": "Ready",
        "status_jobs_fmt": "Jobs: {total} | Done: {completed} | Failed: {failed}",
        "title_print": "Print",
        "title_retry": "Reprint",
        "title_printer": "Printer",
        "title_rules": "Rules",
        "title_delete": "Delete",
        "title_excel": "Excel",
        "title_update": "Update",
        "msg_no_files": "No files to print.",
        "msg_no_checked": "No checked files to print.",
        "msg_no_selected_rows": "No rows selected.",
        "msg_no_failed": "No failed jobs.",
        "title_print_failed": "Print Failed",
        "msg_print_failed": "Printing failed.",
        "msg_printing_in_progress": "Printing is in progress. Please wait or cancel.",
        "msg_excel_orientation_checking": "Checking Excel orientation...",
        "title_checking": "Checking",
        "msg_printer_not_selected": "No printer selected.",
        "msg_rule_exists": "This rule already exists.",
        "msg_delete_confirm_fmt": "Delete {count} selected items?",
        "msg_excel_sheet_required": "Select at least one sheet.",
        "msg_update_available_fmt": "New version {version} is available.\nUpdate now?",
        "msg_update_none": "No updates found.",
        "msg_update_error_fmt": "Failed to check updates.\n{error}",
        "msg_update_downloading": "Downloading update...",
        "msg_update_apply": "Apply update and restart?",
        "btn_update_now": "Update Now",
        "btn_update_later": "Remind in 14 days",
        "btn_update_skip": "Skip",
        "btn_close": "Close",
        "btn_open_log": "Open Log",
        "settings_printer_group": "Printer Settings",
        "settings_rules_group": "Printer by File Type",
        "settings_display_group": "Display",
        "settings_update_group": "Updates",
        "settings_use_default": "Use default printer",
        "settings_select_printer": "Select a printer",
        "settings_select_printer_button": "Choose Printer",
        "settings_printer_settings_button": "Printer Properties",
        "settings_copies": "Copies:",
        "settings_duplex": "Duplex:",
        "duplex_off": "Off",
        "duplex_long": "Long edge",
        "duplex_short": "Short edge",
        "settings_paper_size": "Paper size:",
        "settings_excel_orientation": "Excel orientation:",
        "settings_excel_auto": "Auto adjust",
        "settings_excel_ask": "Ask first",
        "settings_excel_none": "Do not change",
        "settings_rules_type": "Type",
        "settings_rules_printer": "Printer",
        "settings_add": "Add",
        "settings_remove": "Remove",
        "rules_add_title": "Add extension",
        "rules_add_prompt": "Enter extension (e.g. .pdf)",
        "settings_theme": "Theme:",
        "settings_theme_system": "Follow system",
        "settings_theme_light": "Light",
        "settings_theme_dark": "Dark",
        "settings_language": "Language:",
        "settings_update_check": "Check for updates at startup",
        "settings_update_auto": "Enable auto update",
        "rules_auto_tooltip_fmt": "Auto (default): {printer}",
        "printer_button_default_fmt": "Choose Printer (Default: {label})",
        "printer_button_current_fmt": "Choose Printer (Current: {label})",
        "paper_size_default": "Printer default",
        "paper_size_unavailable": "Failed to read paper sizes from printer.",
        "table_print": "Print",
        "table_file": "File",
        "table_path": "Path",
        "table_type": "Type",
        "table_label": "Label",
        "table_sheet": "Sheet",
        "table_printer": "Printer",
        "table_status": "Status",
        "status_waiting": "Waiting",
        "status_printing": "Printing",
        "status_success": "Done",
        "status_failed": "Failed",
        "status_cancelled": "Cancelled",
        "status_skipped": "Skipped",
        "label_auto": "Auto",
        "label_all_sheets": "All sheets",
        "label_pdf": "PDF",
        "label_word": "Word",
        "label_excel": "Excel",
        "label_ppt": "PowerPoint",
        "label_unknown": "Unknown",
        "context_print_selected": "Print selected only",
        "context_printer_select": "Set printer for selected",
        "context_excel_sheets": "Select Excel sheets",
        "context_enable": "Enable selected",
        "context_disable": "Disable selected",
        "context_delete": "Delete selected",
        "progress_title": "Printing",
        "progress_preparing": "Preparing...",
        "progress_printing_fmt": "Printing: {current}",
        "progress_printing": "Printing...",
        "progress_cancel": "Cancel",
        "progress_cancelled": "Cancelled",
        "progress_done": "Completed",
        "about_title": "About",
        "about_text": "Raku Print\nPrint job manager",
        "about_info": "Built for Windows + Office batch printing.\nCopyright © 2026 Hibiki Suzuki",
        "log_title": "Log Summary",
        "log_heading": "Print error summary",
        "log_file": "File",
        "log_summary": "Summary",
        "log_detail": "Detail",
        "log_no_errors": "No failed jobs.",
        "printer_select_title": "Choose Printer",
        "excel_sheet_title": "Excel Sheet Selection",
        "excel_sheet_prompt_fmt": "Select sheets for {file}",
        "excel_sheet_select_all": "Select all",
        "excel_sheet_clear": "Clear",
        "excel_orientation_title": "Excel Orientation",
        "excel_orientation_prompt": "Review orientation recommendations.\nApply auto rotation when printing?",
        "excel_orientation_file": "File",
        "excel_orientation_recommend": "Recommendation",
        "excel_orientation_reason": "Reason",
        "excel_orientation_apply": "Apply",
        "excel_orientation_select_all": "Apply all",
        "excel_orientation_clear": "Clear all",
        "update_checking": "Checking for updates...",
    },
    "ko": {
        "app_title": "라쿠 인쇄",
        "menu_file": "파일",
        "menu_help": "도움말",
        "action_add_files": "파일 추가",
        "action_add_folder": "폴더 추가",
        "action_apply_rules": "규칙 적용(수동 보호)",
        "action_apply_rules_force": "규칙 전체 덮어쓰기",
        "action_exit": "종료",
        "action_about": "정보",
        "action_log_summary": "로그 요약",
        "action_check_updates": "업데이트 확인",
        "button_start_printing": "인쇄 시작",
        "button_retry_failed": "실패만 재인쇄",
        "status_ready": "준비 완료",
        "status_jobs_fmt": "작업: {total} | 완료: {completed} | 실패: {failed}",
        "title_print": "인쇄",
        "title_retry": "재인쇄",
        "title_printer": "프린터",
        "title_rules": "규칙",
        "title_delete": "삭제",
        "title_excel": "Excel",
        "title_update": "업데이트",
        "msg_no_files": "인쇄할 파일이 없습니다.",
        "msg_no_checked": "체크된 파일이 없습니다.",
        "msg_no_selected_rows": "선택한 항목이 없습니다.",
        "msg_no_failed": "실패한 작업이 없습니다.",
        "title_print_failed": "인쇄 실패",
        "msg_print_failed": "인쇄에 실패했습니다.",
        "msg_printing_in_progress": "인쇄 중입니다. 완료를 기다리거나 취소하세요.",
        "msg_excel_orientation_checking": "Excel 방향 확인 중...",
        "title_checking": "확인 중",
        "msg_printer_not_selected": "프린터가 선택되지 않았습니다.",
        "msg_rule_exists": "이미 추가되어 있습니다.",
        "msg_delete_confirm_fmt": "선택한 {count}개를 삭제하시겠습니까?",
        "msg_excel_sheet_required": "하나 이상 선택하세요.",
        "msg_update_available_fmt": "새 버전 {version}이 있습니다.\n업데이트할까요?",
        "msg_update_none": "업데이트가 없습니다.",
        "msg_update_error_fmt": "업데이트 확인 실패.\n{error}",
        "msg_update_downloading": "업데이트 다운로드 중...",
        "msg_update_apply": "업데이트를 적용하고 재시작할까요?",
        "btn_update_now": "지금 업데이트",
        "btn_update_later": "14일 후 알림",
        "btn_update_skip": "이번에는 안 함",
        "btn_close": "닫기",
        "btn_open_log": "로그 열기",
        "settings_printer_group": "프린터 설정",
        "settings_rules_group": "파일 종류별 프린터",
        "settings_display_group": "표시",
        "settings_update_group": "업데이트",
        "settings_use_default": "기본 프린터 사용",
        "settings_select_printer": "프린터 지정",
        "settings_select_printer_button": "프린터 선택",
        "settings_printer_settings_button": "프린터 속성",
        "settings_copies": "부수:",
        "settings_duplex": "양면:",
        "duplex_off": "없음",
        "duplex_long": "긴 면",
        "duplex_short": "짧은 면",
        "settings_paper_size": "용지 크기:",
        "settings_excel_orientation": "Excel 방향:",
        "settings_excel_auto": "자동 조정",
        "settings_excel_ask": "확인 후",
        "settings_excel_none": "변경 안 함",
        "settings_rules_type": "종류",
        "settings_rules_printer": "프린터",
        "settings_add": "추가",
        "settings_remove": "삭제",
        "rules_add_title": "확장자 추가",
        "rules_add_prompt": "확장자를 입력하세요 (예: .pdf)",
        "settings_theme": "테마:",
        "settings_theme_system": "시스템 따름",
        "settings_theme_light": "라이트",
        "settings_theme_dark": "다크",
        "settings_language": "언어:",
        "settings_update_check": "시작 시 업데이트 확인",
        "settings_update_auto": "자동 업데이트 사용",
        "rules_auto_tooltip_fmt": "자동(기본): {printer}",
        "printer_button_default_fmt": "프린터 선택(기본: {label})",
        "printer_button_current_fmt": "프린터 선택(현재: {label})",
        "paper_size_default": "프린터 기본값",
        "paper_size_unavailable": "프린터에서 용지 크기를 가져올 수 없습니다.",
        "table_print": "인쇄",
        "table_file": "파일",
        "table_path": "경로",
        "table_type": "종류",
        "table_label": "라벨",
        "table_sheet": "시트",
        "table_printer": "프린터",
        "table_status": "상태",
        "status_waiting": "대기",
        "status_printing": "인쇄 중",
        "status_success": "완료",
        "status_failed": "실패",
        "status_cancelled": "취소",
        "status_skipped": "건너뜀",
        "label_auto": "자동",
        "label_all_sheets": "전체 시트",
        "label_pdf": "PDF",
        "label_word": "Word",
        "label_excel": "Excel",
        "label_ppt": "PowerPoint",
        "label_unknown": "알 수 없음",
        "context_print_selected": "선택 항목만 인쇄",
        "context_printer_select": "선택 항목 프린터 지정",
        "context_excel_sheets": "Excel 시트 선택",
        "context_enable": "선택 활성화",
        "context_disable": "선택 비활성화",
        "context_delete": "선택 삭제",
        "progress_title": "인쇄 중",
        "progress_preparing": "준비 중...",
        "progress_printing_fmt": "인쇄 중: {current}",
        "progress_printing": "인쇄 중...",
        "progress_cancel": "취소",
        "progress_cancelled": "취소됨",
        "progress_done": "완료됨",
        "about_title": "정보",
        "about_text": "라쿠 인쇄\n인쇄 작업 관리자",
        "about_info": "Windows + Office 배치 인쇄용.\nCopyright © 2026 Hibiki Suzuki",
        "log_title": "로그 요약",
        "log_heading": "인쇄 오류 요약",
        "log_file": "파일",
        "log_summary": "요약",
        "log_detail": "상세",
        "log_no_errors": "실패한 작업이 없습니다.",
        "printer_select_title": "프린터 선택",
        "excel_sheet_title": "Excel 시트 선택",
        "excel_sheet_prompt_fmt": "{file}의 시트를 선택하세요",
        "excel_sheet_select_all": "전체 선택",
        "excel_sheet_clear": "전체 해제",
        "excel_orientation_title": "Excel 방향",
        "excel_orientation_prompt": "방향 추천을 확인하세요.\n인쇄 시 자동 회전할까요?",
        "excel_orientation_file": "파일",
        "excel_orientation_recommend": "추천",
        "excel_orientation_reason": "이유",
        "excel_orientation_apply": "적용",
        "excel_orientation_select_all": "모두 적용",
        "excel_orientation_clear": "모두 해제",
        "update_checking": "업데이트 확인 중...",
    },
    "zh": {
        "app_title": "乐印",
        "menu_file": "文件",
        "menu_help": "帮助",
        "action_add_files": "添加文件",
        "action_add_folder": "添加文件夹",
        "action_apply_rules": "应用规则（保留手动）",
        "action_apply_rules_force": "应用规则（全部覆盖）",
        "action_exit": "退出",
        "action_about": "关于",
        "action_log_summary": "日志摘要",
        "action_check_updates": "检查更新",
        "button_start_printing": "开始打印",
        "button_retry_failed": "仅重打失败",
        "status_ready": "准备就绪",
        "status_jobs_fmt": "任务: {total} | 完成: {completed} | 失败: {failed}",
        "title_print": "打印",
        "title_retry": "重打",
        "title_printer": "打印机",
        "title_rules": "规则",
        "title_delete": "删除",
        "title_excel": "Excel",
        "title_update": "更新",
        "msg_no_files": "没有可打印的文件。",
        "msg_no_checked": "没有勾选的文件。",
        "msg_no_selected_rows": "未选择行。",
        "msg_no_failed": "没有失败的任务。",
        "title_print_failed": "打印失败",
        "msg_print_failed": "打印失败。",
        "msg_printing_in_progress": "正在打印中，请等待或取消。",
        "msg_excel_orientation_checking": "正在检查 Excel 方向...",
        "title_checking": "检查中",
        "msg_printer_not_selected": "未选择打印机。",
        "msg_rule_exists": "已存在。",
        "msg_delete_confirm_fmt": "删除选中的 {count} 项？",
        "msg_excel_sheet_required": "请至少选择一张。",
        "msg_update_available_fmt": "发现新版本 {version}。\n是否更新？",
        "msg_update_none": "未发现更新。",
        "msg_update_error_fmt": "检查更新失败。\n{error}",
        "msg_update_downloading": "正在下载更新...",
        "msg_update_apply": "应用更新并重启？",
        "btn_update_now": "现在更新",
        "btn_update_later": "14天后提醒",
        "btn_update_skip": "这次跳过",
        "btn_close": "关闭",
        "btn_open_log": "打开日志",
        "settings_printer_group": "打印机设置",
        "settings_rules_group": "按文件类型设置打印机",
        "settings_display_group": "显示",
        "settings_update_group": "更新",
        "settings_use_default": "使用默认打印机",
        "settings_select_printer": "指定打印机",
        "settings_select_printer_button": "选择打印机",
        "settings_printer_settings_button": "打印机属性",
        "settings_copies": "份数:",
        "settings_duplex": "双面:",
        "duplex_off": "关闭",
        "duplex_long": "长边",
        "duplex_short": "短边",
        "settings_paper_size": "纸张尺寸:",
        "settings_excel_orientation": "Excel 方向:",
        "settings_excel_auto": "自动调整",
        "settings_excel_ask": "询问后",
        "settings_excel_none": "不更改",
        "settings_rules_type": "类型",
        "settings_rules_printer": "打印机",
        "settings_add": "添加",
        "settings_remove": "删除",
        "rules_add_title": "添加扩展名",
        "rules_add_prompt": "请输入扩展名（例如 .pdf）",
        "settings_theme": "主题:",
        "settings_theme_system": "跟随系统",
        "settings_theme_light": "浅色",
        "settings_theme_dark": "深色",
        "settings_language": "语言:",
        "settings_update_check": "启动时检查更新",
        "settings_update_auto": "启用自动更新",
        "rules_auto_tooltip_fmt": "自动(默认): {printer}",
        "printer_button_default_fmt": "选择打印机(默认: {label})",
        "printer_button_current_fmt": "选择打印机(当前: {label})",
        "paper_size_default": "打印机默认",
        "paper_size_unavailable": "无法从打印机获取纸张尺寸。",
        "table_print": "打印",
        "table_file": "文件名",
        "table_path": "路径",
        "table_type": "类型",
        "table_label": "标签",
        "table_sheet": "工作表",
        "table_printer": "打印机",
        "table_status": "状态",
        "status_waiting": "等待",
        "status_printing": "打印中",
        "status_success": "完成",
        "status_failed": "失败",
        "status_cancelled": "已取消",
        "status_skipped": "已跳过",
        "label_auto": "自动",
        "label_all_sheets": "全部工作表",
        "label_pdf": "PDF",
        "label_word": "Word",
        "label_excel": "Excel",
        "label_ppt": "PowerPoint",
        "label_unknown": "未知",
        "context_print_selected": "仅打印所选",
        "context_printer_select": "为所选指定打印机",
        "context_excel_sheets": "选择 Excel 工作表",
        "context_enable": "启用所选",
        "context_disable": "禁用所选",
        "context_delete": "删除所选",
        "progress_title": "打印中",
        "progress_preparing": "准备中...",
        "progress_printing_fmt": "打印中: {current}",
        "progress_printing": "打印中...",
        "progress_cancel": "取消",
        "progress_cancelled": "已取消",
        "progress_done": "已完成",
        "about_title": "关于",
        "about_text": "乐印\n打印任务管理工具",
        "about_info": "适用于 Windows + Office 批量打印。\nCopyright © 2026 Hibiki Suzuki",
        "log_title": "日志摘要",
        "log_heading": "打印错误摘要",
        "log_file": "文件名",
        "log_summary": "摘要",
        "log_detail": "详情",
        "log_no_errors": "没有失败的任务。",
        "printer_select_title": "选择打印机",
        "excel_sheet_title": "Excel 工作表选择",
        "excel_sheet_prompt_fmt": "请选择 {file} 的工作表",
        "excel_sheet_select_all": "全选",
        "excel_sheet_clear": "全不选",
        "excel_orientation_title": "Excel 方向",
        "excel_orientation_prompt": "请确认方向推荐。\n是否在打印时自动旋转？",
        "excel_orientation_file": "文件",
        "excel_orientation_recommend": "推荐",
        "excel_orientation_reason": "原因",
        "excel_orientation_apply": "应用",
        "excel_orientation_select_all": "全部应用",
        "excel_orientation_clear": "全部取消",
        "update_checking": "正在检查更新...",
    },
}

_current_language = "ja"


def detect_system_language() -> str:
    if sys.platform == "win32":
        try:
            import ctypes

            lang_id = ctypes.windll.kernel32.GetUserDefaultUILanguage()
            primary = lang_id & 0x3FF
            if primary == 0x11:
                return "ja"
            if primary == 0x09:
                return "en"
            if primary == 0x12:
                return "ko"
            if primary == 0x04:
                return "zh"
        except Exception:
            pass
    lang, _ = locale.getdefaultlocale()
    if not lang:
        return "ja"
    lang = lang.lower()
    if lang.startswith("ja"):
        return "ja"
    if lang.startswith("ko"):
        return "ko"
    if lang.startswith("zh"):
        return "zh"
    return "en"


def resolve_language(mode: str) -> str:
    if mode == "system":
        return detect_system_language()
    if mode in ("ja", "en", "ko", "zh"):
        return mode
    return "ja"


def set_language(lang: str) -> None:
    global _current_language
    _current_language = resolve_language(lang)


def current_language() -> str:
    return _current_language


def t(key: str, **kwargs) -> str:
    lang = _current_language
    text = TRANSLATIONS.get(lang, {}).get(key) or TRANSLATIONS["ja"].get(key) or key
    if kwargs:
        try:
            return text.format(**kwargs)
        except Exception:
            return text
    return text


def language_label(code: str) -> str:
    lang = current_language()
    return LANGUAGES.get(code, {}).get(lang, code)

